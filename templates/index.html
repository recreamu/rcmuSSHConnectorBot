<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SSH Web Terminal</title>
    <script src="https://cdn.socket.io/4.0.1/socket.io.min.js"></script>
    <script src="/static/xterm/xterm.js"></script>
    <link rel="stylesheet" href="/static/xterm/xterm.css">
    <style>
        #terminal { width: 100%; height: 90vh; background: black; }
    </style>
</head>
<body>
    <div id="terminal"></div>
    <script>
        const socket = io();
        const term = new Terminal();
        term.open(document.getElementById('terminal'));

        term.onKey(e => {
            if (e.key === '\r') {
                const command = commandBuffer.trim();
                term.write('\r\n');
                socket.emit('run_command', {command});
                commandBuffer = '';
            } else if (e.key === '\u007F') { // backspace
                if (commandBuffer.length > 0) {
                    commandBuffer = commandBuffer.slice(0, -1);
                    term.write('\b \b');
                }
            } else {
                commandBuffer += e.key;
                term.write(e.key);
            }
        });

        socket.on('command_result', data => {
            term.write(data.output || '');
            term.write(data.error || '');
            term.write('\r\n$ ');
        });

        let commandBuffer = '';
        term.write('$ ');
    </script>
</body>
</html>
